<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TastyCorner - D√©tails du plat</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation (m√™me style que l'accueil) -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">TastyCorner</a>
            <button class="burger-menu" id="burgerBtn" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links" id="navLinks">
                <a href="index.html#home">Accueil</a>
                <a href="index.html#menu">Menu</a>
                <a href="index.html#about">√Ä propos</a>
                <a href="index.html#contact">Contact</a>
                <button class="btn-contact" onclick="window.location.href='index.html#contact'">CONTACT NOW</button>
            </div>
        </div>
    </nav>

    <section class="menu" id="details">
        <h2>D√©tails du plat</h2>
        <p>Retrouvez toutes les informations de votre s√©lection</p>

        <div id="loadingSpinner" class="loading-spinner hidden">
            <div class="spinner"></div>
            <p>Chargement du plat...</p>
        </div>

        <div id="errorMessage" class="hidden" style="color: red; font-weight: 600; margin-bottom: 20px;"></div>

        <div id="detailsContainer" style="max-width: 1200px; margin: 0 auto;"></div>

        <div style="margin-top: 25px; display: flex; justify-content: center;">
            <button class="btn-view-all" onclick="window.location.href='index.html'">‚Üê Retour au menu</button>
        </div>
    </section>

    <footer class="footer">
        <p>&copy; 2025 TastyCorner. Tous droits r√©serv√©s.</p>
    </footer>

    <script src="recettes.js"></script>
    <script>
        const loadingSpinner = document.getElementById('loadingSpinner');
        const detailsContainer = document.getElementById('detailsContainer');
        const errorMessage = document.getElementById('errorMessage');
        const params = new URLSearchParams(window.location.search);
        const mealId = params.get('id');

        // Fonction pour extraire l'ID d'une vid√©o YouTube
        function extractYoutubeId(url) {
            if (!url) return null;
            
            // Diff√©rents formats d'URL YouTube
            const patterns = [
                /(?:youtube\.com\/watch\?v=)([^&]+)/,
                /(?:youtube\.com\/embed\/)([^?]+)/,
                /(?:youtu\.be\/)([^?]+)/,
                /(?:youtube\.com\/v\/)([^?]+)/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            
            return null;
        }

        function renderMeal(meal) {
            // Construire la liste des ingr√©dients
            let ingredients = '';
            for (let i = 1; i <= 20; i++) {
                const ingredient = meal[`strIngredient${i}`];
                const measure = meal[`strMeasure${i}`];
                if (ingredient && ingredient.trim()) {
                    const dose = measure ? measure.trim() : '';
                    ingredients += `<li style="padding: 8px 0; border-bottom: 1px solid #f0f0f0;"><span style="color: #e74c3c; font-weight: 700;">${dose}</span> ${ingredient}</li>`;
                }
            }

            const instructions = (meal.strInstructions || '').split('\n').filter(line => line.trim()).map((line, index) => 
                `<li style="padding: 10px 0; border-bottom: 1px solid #f0f0f0; line-height: 1.6;">${line}</li>`
            ).join('');

            // Extraire l'ID de la vid√©o YouTube
            let youtubeEmbed = '';
            if (meal.strYoutube) {
                const youtubeId = extractYoutubeId(meal.strYoutube);
                if (youtubeId) {
                    youtubeEmbed = `
                        <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            <h3 style="color: #e74c3c; margin-bottom: 20px; font-size: 1.5rem; text-align: center;">üé• YouTube</h3>
                            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                <iframe 
                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                                    src="https://www.youtube.com/embed/${youtubeId}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    `;
                }
            }

            detailsContainer.innerHTML = `
                <h3 style="padding: 0 0 20px; font-size: 1.8rem; color: #333; text-align: center;">${meal.strMeal}</h3>
                
                <!-- Section principale avec image et ingr√©dients c√¥te √† c√¥te -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
                    <!-- Image -->
                    <div style="background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="position: relative; width: 100%; height: 350px; border-radius: 12px; overflow: hidden;">
                            <img src="${meal.strMealThumb}" alt="${meal.strMeal}" style="width: 100%; height: 100%; object-fit: cover;">
                            <span style="position: absolute; top: 15px; left: 15px; background: #e74c3c; color: white; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; font-weight: 600;">${meal.strArea || meal.strCategory || 'Cuisine'}</span>
                        </div>
                        <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                            <span style="font-weight: 600; color: #e74c3c; font-size: 1.1rem;">${meal.strCategory || ''}</span>
                            <span style="color: #999;">${meal.strArea || ''}</span>
                        </div>
                    </div>
                    
                    <!-- Ingr√©dients -->
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px; color: #e74c3c; font-size: 1.5rem; text-align: center;">Ingr√©dients</h3>
                        <ul style="list-style: none; padding: 0; margin: 0; max-height: 320px; overflow-y: auto;">
                            ${ingredients}
                        </ul>
                    </div>
                </div>
                
                <!-- Vid√©o YouTube -->
                ${youtubeEmbed}
                
                <!-- √âtapes de pr√©paration -->
                <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h3 style="color: #e74c3c; margin-bottom: 20px; font-size: 1.5rem; text-align: center;">√âtapes de pr√©paration</h3>
                    <ol style="list-style: none; padding: 0; margin: 0; counter-reset: step-counter;">
                        ${instructions}
                    </ol>
                </div>
            `;
        }

        async function init() {
            if (!mealId) {
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = 'Aucun plat s√©lectionn√©.';
                return;
            }

            loadingSpinner.classList.remove('hidden');
            detailsContainer.innerHTML = '';
            errorMessage.classList.add('hidden');

            try {
                const meal = await getMealDetails(mealId);
                if (!meal) {
                    errorMessage.classList.remove('hidden');
                    errorMessage.textContent = 'Plat introuvable.';
                    return;
                }
                renderMeal(meal);
            } catch (err) {
                console.error('Erreur lors du chargement du plat:', err);
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = 'Erreur lors du chargement des d√©tails.';
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        // Menu burger
        const burgerBtn = document.getElementById('burgerBtn');
        const navLinks = document.getElementById('navLinks');
        burgerBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            burgerBtn.classList.toggle('active');
        });
        document.querySelectorAll('.nav-links a, .nav-links button').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                burgerBtn.classList.remove('active');
            });
        });

        init();
    </script>
</body>
</html>
