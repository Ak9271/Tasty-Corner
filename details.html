<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TastyCorner - D√©tails du plat</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation (m√™me style que l'accueil) -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">TastyCorner</a>
            <button class="burger-menu" id="burgerBtn" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links" id="navLinks">
                <a href="index.html#home">Accueil</a>
                <a href="index.html#menu">Menu</a>
                <a href="index.html#about">√Ä propos</a>
                <a href="index.html#contact">Contact</a>
                <button class="btn-contact" onclick="window.location.href='index.html#contact'">CONTACT NOW</button>
            </div>
        </div>
    </nav>

    <section class="menu" id="details">
        <h2>D√©tails du plat</h2>
        <p>Retrouvez toutes les informations de votre s√©lection</p>

        <div id="loadingSpinner" class="loading-spinner hidden">
            <div class="spinner"></div>
            <p>Chargement du plat...</p>
        </div>

        <div id="errorMessage" class="hidden" style="color: red; font-weight: 600; margin-bottom: 20px;"></div>

        <div id="detailsContainer" class="menu-card" style="max-width: 800px; margin: 0 auto;"></div>

        <div style="margin-top: 25px; display: flex; justify-content: center;">
            <button class="btn-view-all" onclick="window.location.href='index.html'">‚Üê Retour au menu</button>
        </div>
    </section>

    <footer class="footer">
        <p>&copy; 2025 TastyCorner. Tous droits r√©serv√©s.</p>
    </footer>

    <script src="recettes.js"></script>
    <script>
        const loadingSpinner = document.getElementById('loadingSpinner');
        const detailsContainer = document.getElementById('detailsContainer');
        const errorMessage = document.getElementById('errorMessage');
        const params = new URLSearchParams(window.location.search);
        const mealId = params.get('id');

        function renderMeal(meal) {
            // Construire la liste des ingr√©dients
            let ingredients = '';
            for (let i = 1; i <= 20; i++) {
                const ingredient = meal[`strIngredient${i}`];
                const measure = meal[`strMeasure${i}`];
                if (ingredient && ingredient.trim()) {
                    const dose = measure ? measure.trim() : '';
                    ingredients += `<li><span style="color: #e74c3c; font-weight: 700;">${dose}</span> ${ingredient}</li>`;
                }
            }

            const instructions = (meal.strInstructions || '').replace(/\n/g, '<br>');

            detailsContainer.innerHTML = `
                <div class="card-image" style="height: 320px;">
                    <img src="${meal.strMealThumb}" alt="${meal.strMeal}" style="width: 100%; height: 100%; object-fit: cover;">
                    <span class="label">${meal.strArea || meal.strCategory || 'Cuisine'}</span>
                </div>
                <h3 style="padding: 20px 15px 10px; font-size: 1.4rem;">${meal.strMeal}</h3>
                <div class="card-info">
                    <span class="price">${meal.strCategory || ''}</span>
                    <span class="time">${meal.strArea || ''}</span>
                </div>
                <div class="card-meta" style="text-align: left;">
                    <h3 style="margin-bottom: 10px; color: #c0392b;">Ingr√©dients</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        ${ingredients}
                    </ul>

                    <div style="margin-top: 15px; display: flex; justify-content: flex-start;">
                        <button id="toggleInstructions" style="padding: 10px 18px; border: none; background: #e74c3c; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            Afficher plus
                        </button>
                    </div>

                    <div id="instructionsContent" class="hidden" style="margin-top: 15px; line-height: 1.6;">
                        <h3 style="color: #c0392b;">Instructions</h3>
                        <p style="margin-top: 8px;">${instructions}</p>
                        ${meal.strYoutube ? `<p style="margin-top: 10px;"><a href="${meal.strYoutube}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">üé• Voir sur YouTube</a></p>` : ''}
                    </div>
                </div>
            `;

            const toggleBtn = document.getElementById('toggleInstructions');
            const instructionsContent = document.getElementById('instructionsContent');
            if (toggleBtn && instructionsContent) {
                toggleBtn.addEventListener('click', () => {
                    const hidden = instructionsContent.classList.contains('hidden');
                    instructionsContent.classList.toggle('hidden');
                    toggleBtn.textContent = hidden ? 'Afficher moins' : 'Afficher plus';
                });
            }
        }

        async function init() {
            if (!mealId) {
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = 'Aucun plat s√©lectionn√©.';
                return;
            }

            loadingSpinner.classList.remove('hidden');
            detailsContainer.innerHTML = '';
            errorMessage.classList.add('hidden');

            try {
                const meal = await getMealDetails(mealId);
                if (!meal) {
                    errorMessage.classList.remove('hidden');
                    errorMessage.textContent = 'Plat introuvable.';
                    return;
                }
                renderMeal(meal);
            } catch (err) {
                console.error('Erreur lors du chargement du plat:', err);
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = 'Erreur lors du chargement des d√©tails.';
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        // Menu burger
        const burgerBtn = document.getElementById('burgerBtn');
        const navLinks = document.getElementById('navLinks');
        burgerBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            burgerBtn.classList.toggle('active');
        });
        document.querySelectorAll('.nav-links a, .nav-links button').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                burgerBtn.classList.remove('active');
            });
        });

        init();
    </script>
</body>
</html>
